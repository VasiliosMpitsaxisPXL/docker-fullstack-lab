# backend/Dockerfile.prod
FROM node:22-alpine

WORKDIR /usr/src/app

# 1. Copy package files first (Layer Caching)
COPY package*.json ./

# 2. Clean Install (Production only, no devDependencies)
# This requires package-lock.json to exist (which you generated in Dev)
RUN npm ci --omit=dev && npm cache clean --force

# 3. Copy source code (Immutable - no volumes in prod)
COPY . .

# 4. Security
USER node

EXPOSE 3000

CMD ["node", "src/index.js"]
